## URL SHORTENER

This project contains a python package for url shortening. 
A Sample file has been provided named `try.py` to demonstrate how to 
run the package functions.

There are two packages available keymanager and shortener. KeyManager is supposed to run as a different service but right
now is being called by shortener which is a bit time consuming.

#### Algorithm

Shortener main job is to generate a tiny url, hence a keymanager package is used to provide random keys to shortener.

Keymanager maintains two tables i.e available_keys and used_keys. Initially it generates a certain number of keys and
puts them to available_keys table. Now whenever a key is requested by the shortener it picks one key from the database
removes it from available_keys pushes it back to used_keys and then returns it back.

While generating keys it is to be kept in mind that the new keys generated by the keymanager should not exists in its both
the tables, because if it does then this particular key has been used before and should be discarded.

To improve the efficiency a local cache has been maintained by the keymanager so that whenever a key is requested by the
shortener it can be returned directly without a db call.

Whenever the local cache reaches a minimum size, a new batch of available_keys are fetched from the db to fill the cache.

TODO: To Improve the time complexity, keymanager should be hosted as a separate service or atleast in a separate process.
MySql can further be replaced with NoSQL db.

#### Installation


Please check the config file for keymanger lying at `keymanager/config/config.py` and insert mysql username, password, 
host accordingly.
 
First run the sql init script `shortener/init.sql` file in mysql to 
create database, and instantiate the tables.
use the following commands

#### Importing Package

use the following line to import package

`import shortener`

#### Shortening a long url

1. Establish a sql connection using the foll. lines
   
    `sess = shortener.get_session(username="root", password="pass", 
    host="0.0.0.0", db_name="shortener")`

2. Call the shorten function to get the tiny url
    
    `shortener.shorten(sess, "https://google.com")`
    
#### Shortening from a file

1. Establish a sql connection using the foll. lines
   
    `sess = shortener.get_session(username="root", password="pass", 
    host="0.0.0.0", db_name="shortener")`

2. Call the shorten function to get a list of all tiny urls
    
    `shortener.shorten_from_file(sess, "file_path")`
    
#### Getting a long url from a tinyUrl

1. Establish a sql connection using the foll. lines
   
    `sess = shortener.get_session(username="root", password="pass",
     host="0.0.0.0", db_name="shortener")`

2. Call the get_original_url funtion to get the long url

    `shortener.get_original_url(sess, "tiny_url")`
    
#### Running test cases

1. Your current directory should be url-shortener
2. Run the following cmds to execute test cases
    
    `python -m  unittest shortener.test`